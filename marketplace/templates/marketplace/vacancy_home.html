{% extends "base_home.html" %}
{% load humanize %}
{% block title %}{{block.super}}-Vacancy{% endblock title %}

{% block content %}

<div class="card" style="width: 100%;">
  <div class="card-body">
    <div class="float-right">
      <a href="{% url 'MarketPlace:History' %}" class="badge badge-primary">View History</a>
    </div>
    <h5 class="card-title">Vacancies suited for Me </h5>
    <table class="table table-sm">
      <thead>
        <tr>
          <th>Vacancy Title</th>
          <th>Hours Required</th>
          <th>Work Format</th>
          <th>Country</th>
          <th>Full Detail</th>
        </tr>
      </thead>
      {% for i in dsd %}
      {% if i.scope.id not in already_applied %}
      <tbody>
      <tr>
        <td>{{ i.scope.title }}</td>
        <td>
          {{ i.scope.hours_required|intcomma }} ({{ i.scope.get_unit_display }})
        </td>
        <td>{{ i.scope.worklocation }}</td>
        <td>{{ i.scope.city }}</td>
          {% if request.user.subscription == 2 %}
            <td><a href="{% url 'MarketPlace:VacancyDetail' i.scope.id %}" class="card-link">See Detail</a></td>
          {% elif request.user.subscription < 2 %}
            <td><a href="#" class="card-link">See Detail</a></td>
          {% endif %}
        </tr>
      </tbody>
      {% endif %}
      {% empty %}
      <tr>
        <td colspan="6">No vacancies matching your skills at the moment</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
<br>
{% if request.user.subscription >= 2 %}
<div class="row">
  <div class="col-sm-7">
    <div class="card">
      <div class="card-body">
        <a href="{% url 'MarketPlace:Vacancy' %}" class="badge badge-primary float-right">Post Vacancy</a>
      <h5 class="card-title">My Vacancies Advertised (Open)</h5>
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Date Posted</th>
            <th>Vacancy Title</th>
            <th>Status</th>
            <th>Closing Date</th>
            <th>Response</th>
          </tr>
        </thead>
        <tbody>
          {% for p in ipost %}
            <tr>
              <td>{{ p.bid_open|date:'j M Y' }}</td>
              <td>{{ p.title }}</td>
              <td>{{ p.get_offer_status_display }}</td>
              <td>{{ p.bid_closes|date:'j M Y' }}</td>
              <td>
              {% if p.id in ipost_bid_flat %}
                <strong>Yes</strong>
              {% else %}
                None
              {% endif %}
              <a href="{% url 'MarketPlace:VacancyPost' p.id %}" class="badge badge-secondary float-right">Detail</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </div>
  </div>
  {% if request.user.subscription >= 1 %}
  <div class="col-sm-5">
    <div class="card">
      <div class="card-body" id='Availabillity'>
        <a href="{% url 'MarketPlace:Availabillity' %}" class="badge badge-primary float-right">Add</a>
        <h5 class="card-title">My Availability</h5>
        <table class="table table-sm">
          <thead>
            <col width="20%">
            <col width="20%">
            <col width="20%">
            <col width="20%">
            <tr>
              <th class="align-middle">Date From</th>
              <th class="align-middle">Date to</th>
              <th class="align-middle">Time Available</th>
            </tr>
          </thead>
          {% for a in capacity %}
          <tbody>
            <tr>
              <td class="align-middle">{{ a.date_from|date:'d M Y' }}</td>
              <td class="align-middle">{{ a.date_to|date:'d M Y' }}</td>
              <td class="align-middle">{{ a.hours_available }} hrs<br>{{ a.get_unit_display }}</td>
              <td class="align-middle ">
                <form  action="{% url 'MarketPlace:NotAvailable' a.id %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="badge badge-danger badge-pill">Remove</button>
                </form>
              </td>
            </tr>
          </tbody>
          {% endfor %}
        </table>
      </div>
    </div>
  </div>
</div>
{% if request.user.subscription >= 2 %}
<div class="row">
  <div class="col-sm-7">
    <div class="card">
      <div class="card-body">
        <a href="{% url 'MarketPlace:AllPostedVac' %}" class="badge badge-primary float-right">All Posted Vacancies</a>
      <h5 class="card-title">My Vacancies Advertised (Closed)</h5>
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Date Posted</th>
            <th>Vacancy Title</th>
            <th>Status</th>
            <th>Closing Date</th>
            <th>Response</th>
          </tr>
        </thead>
        <tbody>
          {% for c in ipost_closed %}
            <tr>
              <td>{{ c.bid_open|date:'j M Y' }}</td>
              <td>{{ c.title }}</td>
              <td>{{ c.get_offer_status_display }}</td>
              <td>{{ c.bid_closes|date:'j M Y' }}</td>
              <td>
              {% if c.id in ipost_bid_flat %}
                <strong>Yes</strong>
              {% else %}
                None
              {% endif %}
              <a href="{% url 'MarketPlace:VacancyPost' c.id %}" class="badge badge-secondary float-right">Detail</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endif %}
{% endif %}
{% endblock content %}
