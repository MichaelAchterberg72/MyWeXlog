{% extends "base_home.html" %}
{% load humanize %}
{% load static %}

{% block title %}{{block.super}}-Dashboard{{ scope.ref_no }}{% endblock title %}

{% block content %}

<div class="container">
  <div class="float-right">
    <a href="{% url 'MarketPlace:VacancyPost' scope.ref_no %}?next={{ request.path|urlencode }}" class="btn btn-secondary">
      Back to {{scope.ref_no}}
    </a>
    <a href="{% url 'MarketPlace:ShortListView' scope.ref_no %}?next={{ request.path|urlencode }}" class="btn btn-info">
      Short-list
    </a>
  </div>

  <h3 class="card-title">
    Vacancy Dashboard for {{ scope.title }} ({{ scope.ref_no }})
  </h3>
    {% if wit_qs %}
    <div class="card border-0">
      <div class="card-body">
          <h4>Vacancy Accepted By</h4>
        <table class="table table-hover table-sm">
          <col width="45%">
          <col width="45%">
          <col width="10%">
          <thead>
            <tr>
              <th class="align-middle text-center">Alias</th>
              <th class="align-middle text-center">Response</th>
              <th class="align-middle text-center">Action</th>
            </tr>
          </thead>
          {% for a in wit_qs %}
          <tbody>
            <tr>
              <td class="align-middle text-center">{{ a.talent.alias }}</td>
              <td class="align-middle text-center">{{ a.get_tlt_response_display }}</td>
              <td class="align-middle text-center">
                <a href="{% url 'Talent:APV' tlt=a.talent.alias  vac=scope.ref_no %}" target="_blank" class="badge badge-secondary badge-pill" style="width: 7rem">
                  View Profile
                </a>
                <a href="{% url 'Profile:WorkshopEmp' %}?next={{ request.path|urlencode }}" class="badge badge-primary badge-pill" style="width: 7rem">
                  Enter Office
                </a>
                {% if a.tlt_response == 'C' %}
                  <a href="{% url 'MarketPlace:RFIView' a.slug %}?next={{ request.path|urlencode }}" class="badge badge-warning badge-pill" style="width: 7rem">
                    Clarification<br>Requested
                  </a>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <br>
    {% endif %}
    {% if wit_qs_p %}
    <div class="card border-0">
      <div class="card-body">
          <h4>Pending Vacancy Acceptance</h4>
        <table class="table table-hover table-sm">
          <col width="45%">
          <col width="45%">
          <col width="10%">
          <thead>
            <tr>
              <th class="align-middle text-center">Alias</th>
              <th class="align-middle text-center">Response</th>
              <th class="align-middle text-center">Action</th>
            </tr>
          </thead>
          {% for a in wit_qs_p %}
          <tbody>
            <tr>
              <td class="align-middle text-center">{{ a.talent.alias }}</td>
              <td class="align-middle text-center">{{ a.get_tlt_response_display }}</td>
              <td class="align-middle text-center">
                <a href="{% url 'Talent:APV' tlt=a.talent.alias  vac=scope.ref_no %}" target="_blank" class="badge badge-secondary badge-pill" style="width: 7rem">
                  View Profile
                </a>
                {% if a.tlt_response == 'A' %}
                <a href="{% url 'Profile:WorkshopEmp' %}?next={{ request.path|urlencode }}" class="badge badge-primary badge-pill" style="width: 7rem">
                  Enter Office
                </a>
                {% endif %}
                {% if a.tlt_response == 'C' %}
                  <a href="{% url 'MarketPlace:RFIView' a.slug %}?next={{ request.path|urlencode }}" class="badge badge-warning badge-pill" style="width: 7rem">
                    Clarification<br>Requested
                  </a>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <table class="table table-sm">
          <thead>
            <tr>
              <th class="align-middle text-center">Stage</th>
              <th class="align-middle text-center">Rate</th>
              <th class="align-middle text-center">Complete Date</th>
              <th class="align-middle text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th class="align-middle text-center">Original Offer</th>
              <td class="align-middle text-center">{{ scope.currency }} <strong>{{ scope.rate_offered|intcomma }}</strong> {{ scope.get_rate_unit_display }}</td>
              <td class="align-middle text-center">{{ scope.date_deadline|date:'j M Y' }}</td>
              <td></td>
            </tr>
            <tr>
              {% for i in wit_qs_p %}
              <th class="align-middle text-center">
                {% if i.tlt_response == 'A' %}
                  Accepted Offer
                {% else %}
                  Current Offer
                {% endif %}
              </th>
                <td class="align-middle text-center">{{ i.currency }} <strong>{{ i.rate_offered|intcomma  }}</strong> {{ i.get_rate_unit_display }}</td>
                <td class="align-middle text-center">{{ i.date_deliverable|date:'j M Y' }}</td>
                <td class="align-middle text-center">
                  {% if i.tlt_response != 'A' %}
                    <a href="{% url 'MarketPlace:VacAssignEdit' i.slug %}">
                      <i class="fa fa-paint-brush" aria-hidden="true" style="font-size:20px;color:black" target="_blank" data-toggle="tooltip" title="Edit Offer">
                      </i>
                    </a>
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <br>
    {% endif %}
    <div class="card border-0">
      <div class="card-body">
        <div class="float-right">
          <a href="{% url 'MarketPlace:VacancyIntDetail' scope.ref_no %}?next={{ request.path|urlencode }}" class="btn btn-info">
            Interview list
          </a>
        </div>
        <h4>Pending Interviews</h4>
        <p>There are a total of {{ interview_p_count }} pending interviews{% if interview_p_count >= 5 %}, we only list the top 5 here.{% else %}.{% endif %}</p>
        <table class="table table-hover table-sm">
          <col width="15%">
          <col width="6%">
          <col width="6%">
          <col width="1%">
          <col width="8%">
          <col width="45%">
          <col width="8%">
          <thead>
            <tr>
              <th class="align-middle text-center">Alias</th>
              <th class="align-middle text-center">Experience</th>
              <th class="align-middle text-center">Training</th>
              <th class="align-middle text-center">Books Read</th>
              <th class="align-middle text-center">Rate</th>
              <th class="align-middle text-left">Motivation</th>
              <th class="align-middle text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for sl in interview_p_slice.items %}
            <tr>
              <td class="align-middle text-center">
                {% if sl.1.count > 1 %}
                  {{ sl.1.ro.0.4 }}<br><strong>{{ sl.1.score }}</strong><br>(by {{ sl.1.count }} people)
                {% else %}
                  {{ sl.1.ro.0.4 }}<br><strong>Not Rated</strong><br>(by < 5 people)
                {% endif %}
              </td>
              <td class="align-middle text-center">{{ sl.1.we|intcomma }}<br>(<strong>{{ sl.1.s_no }}</strong> skills)</td>
              <td class="align-middle text-center">{{ sl.1.te|intcomma }}</td>
              <td class="align-middle text-center">{{ sl.1.rb }}</td>
              <td class="align-middle text-center">{{ sl.1.ro.0.1 }} <strong>{{ sl.1.ro.0.0|intcomma }}</strong> {{ sl.1.ro.0.2 }}</td>
              <td class="align-middle">{{ sl.1.ro.0.3|truncatechars:200 }}</td>
              <td class="align-middle">
                <p>
                  <a href="{% url 'Talent:APV' tlt=sl.1.ro.0.4  vac=scope.ref_no %}" target="_blank" class="badge badge-secondary badge-pill float-right" style="width: 6rem">View Profile</a>
                  <form  action="{% url 'MarketPlace:Suitable' tlt=sl.1.ro.0.4 vac=scope.ref_no %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="badge badge-success badge-pill float-right" style="width: 6rem">Suitable</button>
                  </form>
                    <a href="{% url 'MarketPlace:NotSuitable' tlt=sl.1.ro.0.4 vac=scope.ref_no %}" class="badge badge-danger badge-pill float-right" style="width: 6rem">Not Suitable</a>
                </p>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7">There are no people pending review.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if interview_p_count > 5 %}
          <div class="float-right">
            <a href="{% url 'MarketPlace:PendingInterviewList' vac %}" class="btn btn-primary">View All Pending Interviews</a>
          </div>
        {% endif %}
      </div>
    </div>
    <br>
    <div class="card border-0">
      <div class="card-body">
        {% if wit_qs %}
          {% for a in wit_qs %}
            {% if a.tlt_response == 'A' or a.tlt_response == 'P' or a.tlt_response == 'C' %}
              <h4>Unsuccessful Applicants</h4>
            {% elif a.tlt_response == 'D' %}
              <h4>Suitable Applicants</h4>
            {% endif %}
          {% endfor %}
        {% else %}
          <h4>Suitable Applicants</h4>
        {% endif %}
        <p>There are a total of {{ interview_s_count }} applicants{% if interview_s_count >= 5 %}, we only list the first 5 here.{% else %}.{% endif %}</p>
        <table class="table table-hover table-sm">
           <col width="15%">
           <col width="5%">
           <col width="5%">
           <col width="1%">
           <col width="8%">
           <col width="45%">
           <col width="10%">
           <thead>
             <tr>
               <th class="align-middle text-center">Alias</th>
               <th class="align-middle text-center">Experience</th>
               <th class="align-middle text-center">Training</th>
               <th class="align-middle text-center">Books Read</th>
               <th class="align-middle text-center">Rate</th>
               <th class="align-middle text-left">Motivation</th>
               <th class="align-middle text-center">Action</th>
             </tr>
           </thead>
           <tbody>
             {% for sl in interview_s_slice.items %}
               <tr>
                 <td class="align-middle text-center">
                   {% if sl.1.count > 1 %}
                     {{ sl.1.ro.0.4 }}<br><strong>{{ sl.1.score }}</strong><br>(by {{ sl.1.count }} people)
                   {% else %}
                     {{ sl.1.ro.0.4 }}<br><strong>Not Rated</strong><br>(by < 5 people)
                   {% endif %}
                 </td>
                 <td class="align-middle text-center">{{ sl.1.we|intcomma }}<br>(<strong>{{ sl.1.s_no }}</strong> skills)</td>
                 <td class="align-middle text-center">{{ sl.1.te|intcomma }}</td>
                 <td class="align-middle text-center">{{ sl.1.rb }}</td>
                 <td class="align-middle text-center">{{ sl.1.ro.0.1 }} <strong>{{ sl.1.ro.0.0|intcomma }}</strong> {{ sl.1.ro.0.2 }}</td>
                 <td class="align-middle">{{ sl.1.ro.0.3|truncatechars:200 }}</td>
                 <td class="align-middle text-center">
                   <p>
                     <a href="{% url 'Talent:APV' tlt=sl.1.ro.0.4 vac=scope.ref_no %}" target="_blank" class="badge badge-secondary badge-pill float-right" style="width: 6rem">View Profile</a>
                     {% if active == 'False' %}
                       <form  action="{% url 'MarketPlace:VacAssign' tlt=sl.1.ro.0.4 vac=scope.ref_no %}" method="post">
                         {% csrf_token %}
                         <button type="submit" class="badge badge-success badge-pill float-right" style="width: 6rem">Assign</button>
                         <a href="{% url 'MarketPlace:NotSuitable' tlt=sl.1.ro.0.4 vac=scope.ref_no %}" class="badge badge-danger badge-pill float-right" style="width: 6rem">Not Suitable</a>
                       </form>
                     {% else %}
                       <button type="submit" class="badge badge-success badge-pill float-right" style="width: 6rem">Pending</button>
                     {% endif %}
                   </p>
                 </td>
               </tr>
             {% empty %}
               <tr>
                 <td colspan="7">No talent identified or selected at the moment.</td>
               </tr>
             {% endfor %}
           </tbody>
         </table>
         {% if interview_s_count > 5 %}
           <div class="float-right">
             <a href="{% url 'MarketPlace:SuitableInterviewList' vac %}" class="btn btn-primary">View All Applicants</a>
           </div>
         {% endif %}
       </div>
     </div>
    <br>
    <div class="card border-0">
      <div class="card-body">
        <h4>Unsuitable Applicants</h4>
        <p>There are a total of {{ interview_n_count }} unsuitable applicants{% if interview_n_count >= 5 %}, we only list the first 5 here.{% else %}.{% endif %}</p>
        <table class="table table-hover table-sm">
          <col width="15%">
          <col width="5%">
          <col width="5%">
          <col width="1%">
          <col width="8%">
          <col width="45%">
          <col width="10%">
          <thead>
            <tr>
              <th class="align-middle text-center">Alias</th>
              <th class="align-middle text-center">Experience</th>
              <th class="align-middle text-center">Training</th>
              <th class="align-middle text-center">Books Read</th>
              <th class="align-middle text-center">Rate</th>
              <th class="align-middle text-left">Motivation</th>
              <th class="align-middle text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for sl in interview_n_slice.items %}
            <tr>
              <td class="align-middle text-center">
                {% if sl.1.count > 1 %}
                  {{ sl.1.ro.0.4 }}<br><strong>{{ sl.1.score }}</strong><br>(by {{ sl.1.count }} people)
                {% else %}
                  {{ sl.1.ro.0.4 }}<br><strong>Not Rated</strong><br>(by < 5 people)
                {% endif %}
              </td>
              <td class="align-middle text-center">{{ sl.1.we|intcomma }}<br>(<strong>{{ sl.1.s_no }}</strong> skills)</td>
              <td class="align-middle text-center">{{ sl.1.te|intcomma }}</td>
              <td class="align-middle text-center">{{ sl.1.rb }}</td>
              <td class="align-middle text-center">{{ sl.1.ro.0.1 }} <strong>{{ sl.1.ro.0.0|intcomma }}</strong> {{ sl.1.ro.0.2 }}</td>
              <td class="align-middle">{{ sl.1.ro.0.3|truncatechars:200 }}</td>
              <td class="align-middle text-center">
                <p>
                  <a href="{% url 'Talent:APV' tlt=sl.1.ro.0.4 vac=scope.ref_no %}" target="_blank" class="badge badge-secondary badge-pill float-right" style="width: 5rem">View Profile</a>
                  <form  action="{% url 'MarketPlace:Suitable' tlt=sl.1.ro.0.4  vac=scope.ref_no %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="badge badge-success badge-pill float-right" style="width: 5rem">Suitable</button>
                  </form>
                </p>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7">No talent identified as unsuitbale for this scope.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if interview_n_count > 5 %}
        <div class="float-right">
          <a href="{% url 'MarketPlace:UnsuitableInterviewList' vac %}" class="btn btn-primary">View All Unsuitable Applicants</a>
        </div>
      {% endif %}
    </div>
  </div>
  <br>
  <div class="card border-0">
    <div class="card-body">
      <h4>Declined Invitation for Interview</h4>
      <p>There are a total of {{ intv_declined_count }} interview invitations declined{% if intv_declined_count >= 5 %}, we only list the first 5 here.{% else %}.{% endif %}</p>
      <table class="table table-hover table-sm">
        <col width="15%">
        <col width="15%">
        <col width="70%">
        <thead>
          <tr>
            <th class="align-middle text-center">Alias</th>
            <th class="align-middle text-center">Reason</th>
            <th class="align-middle text-left">Details</th>
          </tr>
        </thead>
        <tbody>
          {% for intd in intv_declined %}
            <tr>
              <td class="align-middle text-center">{{ intd.talent.alias }}</td>
              <td class="align-middle text-center">{{ intd.tlt_decline_reason }}</td>
              <td class="align-middle text-left">{{ intd.comments_tlt|linebreaks }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7">Nobody has Declined the Interview Invitation</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if intv_declined_count > 5 %}
        <div class="float-right">
          <a href="{% url 'MarketPlace:DeclinedInvInterviewList' vac %}" class="btn btn-primary">View All Unsuitable Applicants</a>
        </div>
      {% endif %}
    </div>
  </div>
  <br>
  <div class="card border-0">
    <div class="card-body">
      <h4>Declined Assignment</h4>
      <p>There are a total of {{ vacancy_declined_count }} assignments declined{% if vacancy_declined_count >= 5 %}, we only list the first 5 here.{% else %}.{% endif %}</p>
      <table class="table table-hover table-sm">
        <col width="15%">
        <col width="15%">
        <col width="70%">
        <thead>
          <tr>
            <th class="align-middle text-center">Alias</th>
            <th class="align-middle text-center">Reason</th>
            <th class="align-middle text-left">Details</th>
          </tr>
        </thead>
        <tbody>
          {% for intd in vacancy_declined %}
          <tr>
            <td class="align-middle text-center">{{ intd.talent.alias }}</td>
            <td class="align-middle text-center">{{ intd.tlt_decline_reason }}</td>
            <td class="align-middle text-left">{{ intd.comments|linebreaks }}</td>
          </tr>
          {% empty %}
            <tr>
              <td colspan="7">Nobody has declined an assignment.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if intv_declined_count > 5 %}
        <div class="float-right">
          <a href="{% url 'MarketPlace:DeclinedAssignmentInterviewList' vac %}" class="btn btn-primary">View All Assignments Declined</a>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
{{ form.media.js }}

{% endblock content %}

{% block Script %}

{% endblock Script %}
