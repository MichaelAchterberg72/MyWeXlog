{% extends "base_home.html" %}
{% load humanize %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{{block.super}}-Vacancy Review{% endblock title %}

{% block content %}
{{ form.media.css }}
<style type="text/css">
  select {
    width: 100px;
  }
  </style>

<div class="container">
  <div class="card">
    <div class="card-body">
      <div class="btn-toolbar float-right">
        <form  action="{% url 'BookList:BLB' %}" method="post">
          <input type="hidden" name="next" value="{{ request.GET.next }}">
          {% csrf_token %}
          <button type="submit" class="btn btn-secondary">Back</button>
        </form>&nbsp
          <a href="{% url 'MarketPlace:VacancyEdit' instance.ref_no %}" class="btn btn-info ">Edit Vacancy</a>&nbsp
          <a href="{% url 'MarketPlace:HelpVacancyPost' %}" target="_blank" class="align-middle" style="font-size: 27px" data-toggle="tooltip" title="Click here for help on this page!">
          <i class="icon icon-question-circle"></i></a>
      </div>
      <h3>Vacancy Review</h3>
      <h5 class="card-title">Vacancy: {{ instance.title }} ({{ instance.ref_no }})</h5>
      <table class="table table-sm">
        <thead>
          <tr>
            <th class="align-middle text-center">Own Ref No.</th>
            <th class="align-middle text-center">Company</th>
            <th class="align-middle text-center">Designation</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="align-middle text-center">{{ instance.own_ref_no }}</td>
            <td class="align-middle text-center">{{ instance.companybranch.company }}</td>
            <td class="align-middle text-center">{{ instance.designation }}</td>
          </tr>
        </tbody>
      </table>
      <br>
      <table class="table table-sm">
        <thead>
          <tr>
            <th class="align-middle text-center">Hours Required</th>
            <th class="align-middle text-center">Work Format</th>
            <th class="align-middle text-center">Office Location</th>
            <th class="align-middle text-center">Experience Level</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="align-middle text-center">
              {{ instance.hours_required|intcomma }} ({{ instance.get_unit_display }})
            </td>
            <td class="align-middle text-center">{{ instance.worklocation }}</td>
            <td class="align-middle text-center">{{ instance.city.city }}</td>
            <td class="align-middle text-center">{{ instance.experience_level }}</td>
          </tr>
        </tbody>
      </table>
      <br>
      <div class="row">
        <div class="col-sm-6">
          <div class="h-100">
            <div class="card-body">
              <h5 class="card-title">Scope</h5>
              <p>{{ instance.scope|linebreaks }}</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="h-100">
            <div class="card-body">
              <h5 class="card-title">Expectations</h5>
              <p>{{ instance.expectations|linebreaks }}</p>
            </div>
          </div>
        </div>
      </div>
      <br>
      <div class="">
        <div class="">
          <div class="card-body">
      <table class="table table-sm">
        <thead>
          <tr>
            <th class="align-middle text-center">Proposed Rate</th>
            <th class="align-middle text-center">Bid Closing Date</th>
            <th class="align-middle text-center">Work Completion Date</th>
            <th class="align-middle text-center">Required Language</th>
            <th class="align-middle text-center">Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="align-middle text-center">{{ instance.currency }}<br><strong>{{ instance.rate_offered|intcomma }}</strong><br>({{ instance.get_rate_unit_display }})</td>
            <td class="align-middle text-center">{{ instance.bid_closes|date:'j M Y' }}</td>
            <td class="align-middle text-center">{{ instance.date_deadline|date:'j M Y' }}</td>
            <td class="align-middle text-center">{{ instance.language.all|join:", " }}</td>
            <td class="align-middle text-center">
              {% if instance.offer_status == 'O' %}
                {{ instance.get_offer_status_display }}
                <br>
                <a href="{% url 'MarketPlace:VacClose' instance.ref_no %}" style="font-size: 25px;color:red !important" data-toggle="tooltip" title="Close Vacancy"><i class="fa fa-times" aria-hidden="true"></i></a>
              {% else %}
                {{ instance.get_offer_status_display }}
              {% endif %}
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      </div>
      </div>
      <br>
      <div class="row">

        <div class="col-sm-6">
          <div class="h-100">
            <div class="card-body">
              <a href="{% url 'MarketPlace:Deliverables2' instance.ref_no %}" class="badge badge-primary float-right" style="width: 5rem;">Add</a>
              <h5 class="card-title" id="deliverables">Deliverables</h5>

            <table class="table table-sm">
              <col width="90%">
              <col width="10%">
              <thead>
                <col width="85%">
                <col width="15%">
                <tr>
                  <th>Deliverable</th>
                  <th>Options</th>
                </tr>
              </thead>
              {% for d in delivere %}
              <tbody>
                <tr>
                  <td>{{ d.deliverable|linebreaks|truncatechars:100 }}</td>
                  <td>
                    <a href="{% url 'MarketPlace:DeliverablesEdit' d.scope.ref_no %}" class="badge badge-secondary badge-pill float-right" style="width: 5rem;">Edit</a>
                    <form  action="{% url 'MarketPlace:DeliverablesDelete' d.id %}" method="post">
                      {% csrf_token %}
                    <button type="submit" class="badge badge-danger badge-pill" style="width: 5rem;">Remove</button>
                    </form>
                  </td>
                </tr>
              </tbody>
              {% endfor %}
              </table>
            </div>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="h-100">
            <div class="card-body">
              <a href="{% url 'MarketPlace:Skillsa' instance.ref_no %}" class="badge badge-primary float-right" style="width: 5rem;">Add</a>
              <h5 class="card-title" id="skills">Skills</h5>
              <table class="table table-sm">
                <col width="90%">
                <col width="10%">
                <thead>
                  <col width="85%">
                  <col width="15%">
                  <tr>
                    <th>Skill</th>
                  </tr>
                </thead>
                <tbody>
                  {% for s in skille %}
                  <tr>
                    <td>{{ s.skills }}</td>
                    <td><form  action="{% url 'MarketPlace:SkillDelete' s.id %}" method="post">
                      {% csrf_token %}
                      <button type="submit" class="badge badge-danger badge-pill float-right" style="width: 5rem;">Remove</button>
                    </form></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <p>&nbsp</p>
  <div class="float-right">
    <a href="{% url 'Profile:WorkshopEmp' %}?next={{ request.path|urlencode }}" class="btn btn-primary" style="width: 8rem">Enter Office</a>
    <a href="{% url 'MarketPlace:EmployerInterviewHistory' request.user.alias %}?next={{ request.path|urlencode }}" class="btn btn-primary">Interview History</a>
  </div>
  <div><a href="{% url 'MarketPlace:ShortListView' instance.ref_no %}?next={{ request.path|urlencode }}" class="btn btn-info">View Short-list</a>
    &nbsp
    <a href="{% url 'MarketPlace:VacancyIntDetail' instance.ref_no %}" class="btn btn-info">Interview List</a>
    &nbsp
    <a href="{% url 'MarketPlace:InterviewList' instance.ref_no %}?next={{ request.path|urlencode }}" class="btn btn-info">Vacancy Dashboard</a>
  </div>
  <br>


  <div class="card">
    <div class="card-body">
      <div class="float-right">
        <a href="{% url 'MarketPlace:HelpApplicantsVacancy' %}" target="_blank" class="align-middle" style="font-size: 27px" data-toggle="popover" title="Click here for help on this page!">
        <i class="icon icon-question-circle"></i></a>
      </div>
    <h3>Applicants</h3>
    <p>There are a total of {{ applied_count }} bids that talent have applied for the vacancy{% if applied_count >= 5 %}, we only list the top 5 here.{% else %}.{% endif %}</p>
    <div class="">
    <table class="table table-hover table-sm">
      <col width="15%">
      <col width="5%">
      <col width="5%">
      <col width="1%">
      <col width="8%">
      <col width="45%">
      <col width="10%">
      <thead>
        <tr>
          <th class="align-middle text-center">Alias</th>
          <th class="align-middle text-center">Experience</th>
          <th class="align-middle text-center">Training</th>
          <th class="align-middle text-center">Books Read</th>
          <th class="align-middle text-center">Bid Rate</th>
          <th class="align-middle text-left">Motivation</th>
          <th class="align-middle text-center">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for key in applied_slice.items %}
        <tr>
          <td class="align-middle text-center">{{ key.1.ro.0.4 }}</td>
          <td class="align-middle text-center">{{ key.1.we|intcomma }}<br>(<strong>{{ key.1.s_no }}</strong> skills)</td>
          <td class="align-middle text-center">{{ key.1.te|intcomma }}</td>
          <td class="align-middle text-center">{{ key.1.rb }}</td>
          <td class="align-middle text-center">{{ key.1.ro.0.1 }}<br><strong>{{ key.1.ro.0.0|intcomma }}</strong><br>{{ key.1.ro.0.2 }}</td>
          <td class="align-middle text-left">{{ key.1.ro.0.3|truncatechars:190 }}</td>
          <td class="align-middle text-center">
            <p>
              <form  action="{% url 'MarketPlace:ShortList' tlt=key.1.ro.0.4  vac=instance.ref_no %}" method="post" name="active">
              {% csrf_token %}
              <button type="submit"  class="badge badge-info badge-pill float-right" style="width: 5rem;">Short-list</button>
            </form><br>
            <a href="{% url 'Talent:APV' tlt=key.1.ro.0.4 vac=instance.ref_no %}?next={{ request.path|urlencode }}" class="badge badge-success badge-pill float-right" style="width: 5rem;" target="new">View Profile</a>
          </p>
        </td>
          {% empty %}
            {% if s_list %}
              <td colspan="6">All applicants have been short-listed.</td>
              <td>
                <a href="{% url 'MarketPlace:ShortListView' instance.ref_no %}?next={{ request.path|urlencode }}" class="badge badge-info">Goto Short-list</a>
              </td>
            {% else %}
            <td colspan="7">No applications for this vacancy.</td>
            {% endif %}
          </td>
        </tr>
      </tbody>
      {% endfor %}
    </table>
    {% if applied_count > 5 %}
      <p>&nbsp</p>
      <div class="float-right">
        <a href="{% url 'MarketPlace:ApplicantsForVacancy' vac=instance.ref_no %}" class="btn btn-primary"style="width: 10rem">View All Applicants</a>
      </div>
    {% endif %}
    </div>
  </div>
</div>

<br>

  <div class="card">
    <div class="card-body">
      <div class="float-right">
        <a href="{% url 'MarketPlace:HelpTalentSuitedVacancy' %}" target="_blank" class="align-middle" style="font-size: 27px" data-toggle="popover" title="Click here for help on this page!">
        <i class="icon icon-question-circle"></i></a>
      </div>
      <h3 id='suited'>Talent suited to the Vacancy</h3>
      <p>There are a total of {{ suitable_count }} talent suited to the vacancy{% if suitable_count >= 5 %}, we only list the top 5 here.{% else %}.{% endif %}</p>
      <div class="">
        <table class="table table-hover table-sm">
          <col width="15%">
          <col width="5%">
          <col width="5%">
          <col width="1%">
          <col width="8%">
          <col width="45%">
          <col width="10%">
          <thead>
            <tr>
              <th class="align-middle text-center">Alias</th>
              <th class="align-middle text-center">Experience</th>
              <th class="align-middle text-center">Training</th>
              <th class="align-middle text-center">Books Read</th>
              <th class="align-middle text-center">Rate</th>
              <th class="align-middle text-left">Motivation</th>
              <th class="align-middle text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            {% for key in suitable_slice.items %}
            <tr>
              <td class="align-middle text-center">{{ key.1.ro.0.4 }}</td>
              <td class="align-middle text-center">{{ key.1.we|intcomma }}<br>(<strong>{{ key.1.s_no }}</strong> skills)</td>
              <td class="align-middle text-center">{{ key.1.te|intcomma }}</td>
              <td class="align-middle text-center">{{ key.1.rb }}</td>
              <td class="align-middle text-center">{{ key.1.ro.0.1 }}<br><strong>{{ key.1.ro.0.0|intcomma }}</strong><br>{{ key.1.ro.0.2 }}</td>
              <td class="align-middle text-left">{{ key.1.ro.0.3|truncatechars:190 }}</td>
              <td class="align-middle text-center">
                <p>
              <form  action="{% url 'MarketPlace:ShortList' tlt=key.1.ro.0.4  vac=instance.ref_no %}" method="post">
                {% csrf_token %}
                <button type="submit" class="badge badge-info badge-pill float-right" style="width: 5rem;">Short-list</button>
              </form><br>
              <a href="{% url 'Talent:APV' tlt=key.1.ro.0.4 vac=instance.ref_no %}" class="badge badge-success badge-pill float-right" style="width: 5rem;" target="new">View Profile</a></p>
              </td>
            {% empty %}
              {% if s_list %}
                  <td colspan="6">All suitable talent has been short-listed.</td>
                  <td>
                    <a href="{% url 'MarketPlace:ShortListView' instance.ref_no %}?next={{ request.path|urlencode }}" class="badge badge-info">Goto Short-list</a>
                  </td>
              {% else %}
                    <td colspan="7">There is no talent currently in MyWexLog suited to this vacancy.</td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% if suitable_count > 5 %}
        <div class="float-right">
          <a href="{% url 'MarketPlace:TalentSuitedToVacancy' instance.ref_no %}" class="btn btn-primary"style="width: 10rem">View All Talent</a>
        </div>
      {% endif %}
    </div>
  </div>
  <br>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
{{ form.media.js }}

{% endblock content %}

{% block Script %}
<!-- code for popups -->
<script type="text/javascript">
function showAddPopup(triggeringLink) {
    var name = triggeringLink.id.replace(/^add_/, '');
    href = triggeringLink.href;
    var win = window.open(href, name, 'height=500,width=800,resizable=yes,scrollbars=yes');
    win.focus();
    return false;
}

function closePopup(win, newID, newRepr, id) {
    $(id).append('<option value=' + newID + ' selected >' + newRepr + '</option>')
    win.close();
}

window.onerror = function (msg) {
  $("body").attr("JSError", msg);
}
</script>
{% endblock Script %}
